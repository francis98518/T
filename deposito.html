<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caixa de Pagamento</title>
    <style>
        /* Seu estilo permanece inalterado */
    </style>
</head>
<body>

    <button class="back-button" onclick="goBack()">‹</button>

    <h2> Carregamentos</h2>

    <div class="container">
        <p>Montante</p>
        <div class="amount" id="amountDisplay">KZ 0</div>

        <div class="bank-options">
            <!-- Seu conteúdo de banco permanece inalterado -->
        </div>

        <div class="upload-section">
            <p>Por favor, carregue o recibo da transação após o pagamento</p>
            <label for="receipt" class="upload-box">
                <img src="https://t-mob.pro/public/img/home_menu_widthdraw@3x.9fe68243.png" alt="Upload Icon">
                <p>Clique em Carregar</p>
            </label>
            <input type="file" id="receipt" onchange="uploadReceipt(event)">
        </div>
    </div>

    <div id="toast" class="toast">Recibo carregado com sucesso! Redirecionando...</div>

    <script>
        // Exibir o valor armazenado de recarga
        const amount = localStorage.getItem("amount");
        document.getElementById("amountDisplay").textContent = "KZ " + (amount || "0");

        // Função para mostrar/ocultar IBAN
        function toggleIBAN(bank) {
            const ibanElement = document.getElementById("iban" + bank);
            ibanElement.style.display = ibanElement.style.display === "block" ? "none" : "block";
        }

        // Função para copiar o IBAN
        function copyIBAN(ibanId) {
            const ibanText = document.getElementById(ibanId).textContent;

            // Criar um input temporário para copiar
            const tempInput = document.createElement("input");
            tempInput.value = ibanText;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);

            // Exibir toast de sucesso
            showToast("IBAN copiado com sucesso!");
        }

        // Função para exibir o toast
        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.textContent = message;
            toast.className = "toast show";
            setTimeout(() => {
                toast.className = toast.className.replace("show", "");
            }, 3000);
        }

        // Função para voltar à página anterior
        function goBack() {
            window.location.href = "recarregar.html";
        }

        // Função para carregar o recibo
        function uploadReceipt(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    // Mostrar o toast de sucesso
                    showToast("Recibo carregado com sucesso!");

                    // Salvar os dados no LocalStorage
                    const transactionData = {
                        amount: localStorage.getItem("amount"),
                        receipt: e.target.result, // O recibo em base64
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem("transactionData", JSON.stringify(transactionData));

                    // Enviar os dados para a API
                    sendTransactionData(transactionData);
                };

                reader.readAsDataURL(file); // Converte o recibo para base64
            }
        }

        // Função para enviar os dados para a API
        function sendTransactionData(transactionData) {
            fetch('https://meuappi.onrender.com/depositos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(transactionData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Sucesso:', data);
                setTimeout(() => {
                    window.location.href = "home.html"; // Redireciona após 3 segundos
                }, 3000);
            })
            .catch(error => {
                console.error('Erro:', error);
                showToast("Erro ao enviar os dados. Tente novamente.");
            });
        }
    </script>

</body>
</html>
